<!DOCTYPE html>
<html>

<head>
    <title></title>
    <style type="text/css">
    body,
    div {
        margin: 0px;
        padding: 0px;
        box-sizing: border-box;
    }

    .netUnit-table {
        width: 1000px;
        display: table;
        table-layout: fixed;
        padding: 0px;
        padding-top: 10px;
        overflow: auto;
    }

    .netUnit-tr {
        display: table-row;
    }

    .netUnit-td {
        display: table-cell;
        border-left: 1px solid red;
        border-bottom: 1px solid grey;
        text-align: center;
        vertical-align: middle;
        width: 180px;
        height: 120px;
    }

    .netUnit-th {
        display: table-cell;
        text-align: left;
        vertical-align: bottom;
        width: 180px;
    }
    </style>
</head>

<body>
    <div id="myModel">
        <div class="netUnit-table">
            <div class="netUnit-tr" id="tabletitle">
            </div>
            <div class="netUnit-tr">
                <div class='netUnit-td'>300</div>
                <div class='netUnit-td'>
                    <div style="border:1px solid grey;"><span>20160701000348.3980</span></div>
                    <div>&nbsp;&nbsp;</div>
                    <div style="border:1px solid grey;"><span>S_IP:10.184.54.139</span></div>
                    <div style="border:1px solid grey;"><span>D_IP:10.184.54.136</span></div>
                </div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'>AA</div>
                <div class='netUnit-td'>AA</div>
                <div class='netUnit-td'>AAA</div>
            </div>
            <div class="netUnit-tr">
                <div class='netUnit-td'>300</div>
                <div class='netUnit-td'>
                    <div style="border:1px solid grey;"><span>20160701000348.3980</span></div>
                    <div>&nbsp;&nbsp;</div>
                    <div style="border:1px solid grey;"><span>S_IP:10.184.54.139</span></div>
                    <div style="border:1px solid grey;"><span>D_IP:10.184.54.136</span></div>
                </div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
            </div>
            <div class="netUnit-tr">
                <div class='netUnit-td'>300</div>
                <div class='netUnit-td'>
                </div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'>
                    <div style="border:1px solid grey;"><span>20160701000348.3980</span></div>
                    <div>&nbsp;&nbsp;</div>
                    <div style="border:1px solid grey;"><span>S_IP:10.184.54.139</span></div>
                    <div style="border:1px solid grey;"><span>D_IP:10.184.54.136</span></div>
                </div>
                <div class='netUnit-td'>
                </div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
            </div>
            <div class="netUnit-tr">
                <div class='netUnit-td'>300</div>
                <div class='netUnit-td'>
                    <div style="border:1px solid grey;"><span>20160701000348.3980</span></div>
                    <div>&nbsp;&nbsp;</div>
                    <div style="border:1px solid grey;"><span>S_IP:10.184.54.139</span></div>
                    <div style="border:1px solid grey;"><span>D_IP:10.184.54.136</span></div>
                </div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
                <div class='netUnit-td'></div>
            </div>
        </div>
        <canvas id="arrow1" width="1000" height="80" style="position:absolute;left:0px;top:30px;z-index: 100">Your browser does not support the canvas element.</canvas>
        <canvas id="arrow2" width="1000" height="80" style="position:absolute;left:0px;top:150px;z-index: 100">Your browser does not support the canvas element.</canvas>
        <canvas id="arrow3" width="1000" height="80" style="position:absolute;left:0px;top:270px;z-index: 100">Your browser does not support the canvas element.</canvas>
    </div>
    <div id="showCanvas"></div>
    <div>
    	<button id="saveBtn">保存为图片</button>
    </div>
    <script type="text/javascript" src="jquery-1.10.2.min.js"></script>
    <script type="text/javascript">
	    function myUnique(arr) {
	        var res = [];
	        var json = {};
	        for (var i = 0; i < arr.length; i++) {
	            if (arr[i] == "(null)")
	                arr[i] = "Unknow";
	            if (!json[arr[i]]) {
	                res.push(arr[i]);
	                json[arr[i]] = 1;
	            }
	        }
	        return res;
	    };
	    var arr = ["MGCF", "I-CSCF", "I-CSCF", "DRA", "DRA", "HSS", "MGCF", "S-CSCF", "S-CSCF", "(null)", "(null)", "DRA", "(null)", "DRA", "(null)", "S-CSCF", "S-CSCF", "SCCAS", "SCCAS", "S-CSCF", "S-CSCF", "(null)", "(null)", "S-CSCF", "S-CSCF", "SCCAS", "SCCAS", "DRA", "DRA", "HSS", "SCCAS", "S-CSCF", "S-CSCF", "SBC", "(null)", "(null)"];
	    console.log(myUnique(arr).sort());
	    var newArr = myUnique(arr).sort();

	    for (var i in newArr) {
	        if (i == 0)
	            $("#tabletitle").append("<div class='netUnit-th'>&nbsp;</div>");
	        $("#tabletitle").append("<div class='netUnit-th'>" + newArr[i] + "</div>");
	    }

	    var s_ne = "MGCF";
	    var d_ne = "I-CSCF";
	    var s_ip = "10.184.54.139";
	    var d_ip = "10.184.54.136";
	    var s_time = "20160701000348.3980";

	    // $(".netunit-ne li").css('width',1200/(newArr.length+1)-3 + "px");



	    function Line(x1, y1, x2, y2) {
	        this.x1 = x1;
	        this.y1 = y1;
	        this.x2 = x2;
	        this.y2 = y2;
	    }
	    Line.prototype.drawWithArrowheads = function(ctx) {

	        // arbitrary styling
	        ctx.strokeStyle = "black";
	        ctx.fillStyle = "grey";
	        ctx.lineWidth = 1;

	        // draw the line
	        ctx.beginPath();
	        ctx.setLineDash([5, 5]);
	        ctx.moveTo(this.x1, this.y1);
	        ctx.lineTo(this.x2, this.y2);
	        ctx.stroke();

	        // draw the starting arrowhead
	        // var startRadians = Math.atan((this.y2 - this.y1) / (this.x2 - this.x1));
	        // startRadians += ((this.x2 > this.x1) ? -90 : 90) * Math.PI / 180;
	        // this.drawArrowhead(ctx, this.x1, this.y1, startRadians);
	        // draw the ending arrowhead
	        var endRadians = Math.atan((this.y2 - this.y1) / (this.x2 - this.x1));
	        endRadians += ((this.x2 > this.x1) ? 90 : -90) * Math.PI / 180;
	        this.drawArrowhead(ctx, this.x2, this.y2, endRadians);

	    }
	    Line.prototype.drawArrowhead = function(ctx, x, y, radians) {
	        ctx.save();
	        ctx.beginPath();
	        ctx.translate(x, y);
	        ctx.rotate(radians);
	        ctx.moveTo(0, 0);
	        ctx.lineTo(5, 20);
	        ctx.lineTo(-5, 20);
	        ctx.closePath();
	        ctx.restore();
	        ctx.fill();
	    }

	    var iheight = 120;
	    var iwidth = 180;
	    var canvas = document.getElementById("arrow1");
	    var context = canvas.getContext("2d");
	    var line = new Line(iwidth, 50, iwidth * 2, 50);
	    line.drawWithArrowheads(context);

	    var canvas = document.getElementById("arrow2");
	    var context = canvas.getContext("2d");
	    var line = new Line(iwidth * 2, 50, iwidth * 4, 50);
	    line.drawWithArrowheads(context);

	    var canvas = document.getElementById("arrow3");
	    $("#arrow3").css('width', iwidth * 6);
	    var context = canvas.getContext("2d");
	    var line = new Line(iwidth * 6, 50, iwidth * 3, 50);
	    line.drawWithArrowheads(context);
    </script>

    <script type="text/javascript" src="html2canvas.js"></script>
    <script type="text/javascript">
        html2canvas(document.getElementById('myModel')).then(function(canvas) {
            document.getElementById('showCanvas').appendChild(canvas);
            Canvas2Image.saveAsImage(canvas, canvas.width, canvas.height, 'png');
        });
    </script>
    <script type="text/javascript" src="canvas2image.js"></script>
</body>

</html>